/* YOYAKU PLAYER - IPHONE FIX ROBUSTE */

/* ==============================================
   VIEWPORT META TAG SIMULATION VIA CSS
   ============================================== */

/* Force responsive behavior even without proper viewport tag */
@viewport {
    width: device-width;
    initial-scale: 1.0;
    user-scalable: no;
}

/* ==============================================
   IPHONE DETECTION PLUS ROBUSTE
   ============================================== */

/* iPhone ALL MODELS - Plus spécifique */
@media screen and (max-width: 430px) and (-webkit-min-device-pixel-ratio: 2),
       screen and (max-device-width: 430px) and (-webkit-min-device-pixel-ratio: 2),
       screen and (max-width: 390px) and (-webkit-min-device-pixel-ratio: 3),
       screen and (max-device-width: 390px) and (-webkit-min-device-pixel-ratio: 3),
       screen and (max-width: 375px) and (-webkit-min-device-pixel-ratio: 2),
       screen and (max-device-width: 375px) and (-webkit-min-device-pixel-ratio: 2),
       screen and (max-width: 414px) and (-webkit-min-device-pixel-ratio: 3),
       screen and (max-device-width: 414px) and (-webkit-min-device-pixel-ratio: 3) {
    
    /* FORCE LAYOUT 2 LIGNES IPHONE */
    .yoyaku-player-ultra-fin {
        height: 110px !important;
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100vw !important;
        transform: translateY(0) !important;
        z-index: 999999 !important;
        background: #2d2d2d !important;
        box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.8) !important;
    }
    
    .yoyaku-player-ultra-fin.active {
        transform: translateY(0) !important;
    }
    
    .yoyaku-player-ultra-fin .player-inner {
        height: 110px !important;
        display: grid !important;
        grid-template-rows: 55px 55px !important;
        grid-template-columns: 50px 1fr 120px 40px !important;
        grid-template-areas: 
            "vinyl metadata controls cart"
            "vinyl waveform waveform waveform" !important;
        gap: 0 !important;
        padding: 3px !important;
        align-items: center !important;
        max-width: none !important;
        margin: 0 !important;
    }
    
    /* VINYL - 2 LIGNES */
    .yoyaku-player-ultra-fin .vinyl-cover {
        grid-area: vinyl !important;
        grid-row: 1 / 3 !important;
        width: 45px !important;
        height: 104px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        flex-shrink: 0 !important;
    }
    
    .yoyaku-player-ultra-fin .vinyl-wrapper {
        width: 40px !important;
        height: 40px !important;
        border-radius: 50% !important;
    }
    
    .yoyaku-player-ultra-fin .vinyl-image {
        width: 40px !important;
        height: 40px !important;
        border-radius: 50% !important;
        object-fit: cover !important;
    }
    
    /* LIGNE 1: METADATA */
    .yoyaku-player-ultra-fin .playlist-container {
        grid-area: metadata !important;
        margin: 0 !important;
        padding: 3px !important;
        min-width: auto !important;
        max-width: none !important;
        flex: none !important;
    }
    
    .yoyaku-player-ultra-fin .playlist-info {
        padding: 0 !important;
        flex: none !important;
    }
    
    .yoyaku-player-ultra-fin .product-line-1 {
        font-size: 9px !important;
        font-weight: 600 !important;
        color: #fff !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        margin-bottom: 2px !important;
        line-height: 1.1 !important;
    }
    
    .yoyaku-player-ultra-fin .product-line-2 {
        font-size: 8px !important;
        color: rgba(255,255,255,0.7) !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        line-height: 1.1 !important;
    }
    
    /* LIGNE 1: CONTROLS */
    .yoyaku-player-ultra-fin .player-controls {
        grid-area: controls !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 2px !important;
        padding: 0 !important;
        flex: none !important;
    }
    
    .yoyaku-player-ultra-fin .control-btn {
        width: 30px !important;
        height: 30px !important;
        min-width: 30px !important;
        min-height: 30px !important;
        max-width: 30px !important;
        max-height: 30px !important;
        border-radius: 50% !important;
        background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.08)) !important;
        border: 1px solid rgba(255,255,255,0.3) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        font-size: 12px !important;
        flex-shrink: 0 !important;
        box-sizing: border-box !important;
    }
    
    .yoyaku-player-ultra-fin .control-btn.play-pause {
        width: 34px !important;
        height: 34px !important;
        min-width: 34px !important;
        min-height: 34px !important;
        max-width: 34px !important;
        max-height: 34px !important;
        background: linear-gradient(135deg, rgba(255,215,0,0.25), rgba(255,215,0,0.15)) !important;
        border: 1px solid rgba(255,215,0,0.5) !important;
    }
    
    /* LIGNE 1: CART BUTTON - TOUJOURS VISIBLE */
    .yoyaku-player-ultra-fin .cart-btn {
        display: flex !important;
        grid-area: cart !important;
        width: 32px !important;
        height: 32px !important;
        min-width: 32px !important;
        min-height: 32px !important;
        max-width: 32px !important;
        max-height: 32px !important;
        border-radius: 50% !important;
        background: #7db9d8 !important;
        border: 1px solid rgba(125,185,216,0.6) !important;
        color: white !important;
        font-size: 14px !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        flex-shrink: 0 !important;
        align-items: center !important;
        justify-content: center !important;
        z-index: 10 !important;
        cursor: pointer !important;
    }
    
    /* LIGNE 2: WAVEFORM PLEINE LARGEUR */
    .yoyaku-player-ultra-fin .waveform-container {
        grid-area: waveform !important;
        grid-column: 2 / -1 !important;
        width: calc(100vw - 55px) !important;
        height: 45px !important;
        margin: 3px 5px 3px 3px !important;
        background: rgba(45,45,45,0.9) !important;
        border-radius: 22px !important;
        overflow: hidden !important;
        min-width: auto !important;
        border: 1px solid #666 !important;
        position: relative !important;
        flex: none !important;
    }
    
    .yoyaku-player-ultra-fin #waveform {
        height: 100% !important;
        width: 100% !important;
    }
    
    .yoyaku-player-ultra-fin #waveform canvas {
        height: 43px !important;
        width: 100% !important;
    }
    
    /* MASQUER ELEMENTS DESKTOP */
    .yoyaku-player-ultra-fin .track-display {
        display: none !important;
    }
    
    .yoyaku-player-ultra-fin .playlist-dropdown {
        display: none !important;
    }
    
    .yoyaku-player-ultra-fin .pitch-icon,
    .yoyaku-player-ultra-fin .pitch-popup {
        display: none !important;
    }
    
    .yoyaku-player-ultra-fin .volume-icon {
        display: none !important;
    }
    
    .yoyaku-player-ultra-fin .audio-controls {
        display: none !important;
    }
    
    /* BODY PADDING */
    body {
        padding-bottom: 110px !important;
    }
}

/* ==============================================
   IPHONE SE ET TRÈS PETITS ÉCRANS
   ============================================== */

@media screen and (max-width: 375px) and (-webkit-min-device-pixel-ratio: 2),
       screen and (max-device-width: 375px) and (-webkit-min-device-pixel-ratio: 2) {
    
    .yoyaku-player-ultra-fin {
        height: 100px !important;
    }
    
    .yoyaku-player-ultra-fin .player-inner {
        height: 100px !important;
        grid-template-rows: 50px 50px !important;
        grid-template-columns: 42px 1fr 110px 32px !important;
        padding: 2px !important;
    }
    
    .yoyaku-player-ultra-fin .vinyl-cover {
        width: 40px !important;
        height: 96px !important;
    }
    
    .yoyaku-player-ultra-fin .vinyl-wrapper,
    .yoyaku-player-ultra-fin .vinyl-image {
        width: 36px !important;
        height: 36px !important;
    }
    
    .yoyaku-player-ultra-fin .control-btn {
        width: 26px !important;
        height: 26px !important;
        min-width: 26px !important;
        min-height: 26px !important;
        max-width: 26px !important;
        max-height: 26px !important;
        font-size: 10px !important;
    }
    
    .yoyaku-player-ultra-fin .control-btn.play-pause {
        width: 30px !important;
        height: 30px !important;
        min-width: 30px !important;
        min-height: 30px !important;
        max-width: 30px !important;
        max-height: 30px !important;
    }
    
    .yoyaku-player-ultra-fin .cart-btn {
        width: 28px !important;
        height: 28px !important;
        min-width: 28px !important;
        min-height: 28px !important;
        max-width: 28px !important;
        max-height: 28px !important;
        font-size: 12px !important;
    }
    
    .yoyaku-player-ultra-fin .waveform-container {
        height: 40px !important;
        width: calc(100vw - 48px) !important;
        margin: 2px 4px 2px 2px !important;
    }
    
    .yoyaku-player-ultra-fin .product-line-1 {
        font-size: 8px !important;
    }
    
    .yoyaku-player-ultra-fin .product-line-2 {
        font-size: 7px !important;
    }
    
    body {
        padding-bottom: 100px !important;
    }
}

/* ==============================================
   FORCE CLASSES JS - BACKUP SYSTEM
   ============================================== */

/* Si les classes JS ne sont pas appliquées, forcer le style */
.yoyaku-player-ultra-fin.mobile-layout,
.yoyaku-player-ultra-fin.iphone-device,
/* FORCE sur tout écran petit */
.yoyaku-player-ultra-fin {
    /* Les règles ci-dessus s'appliquent automatiquement */
}

/* ==============================================
   WEBKIT SPECIFIC FIXES
   ============================================== */

/* iPhone Safari optimizations */
@supports (-webkit-appearance: none) {
    .yoyaku-player-ultra-fin {
        /* Force hardware acceleration */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
    }
    
    .yoyaku-player-ultra-fin .vinyl-wrapper {
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
    }
    
    /* Fix touch events */
    .yoyaku-player-ultra-fin .control-btn,
    .yoyaku-player-ultra-fin .cart-btn,
    .yoyaku-player-ultra-fin .waveform-container {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
    }
}

/* ==============================================
   LANDSCAPE MODE FIX
   ============================================== */

@media screen and (max-height: 500px) and (orientation: landscape) {
    .yoyaku-player-ultra-fin {
        height: 80px !important;
    }
    
    .yoyaku-player-ultra-fin .player-inner {
        height: 80px !important;
        grid-template-rows: 40px 40px !important;
        padding: 1px !important;
    }
    
    .yoyaku-player-ultra-fin .vinyl-cover {
        width: 35px !important;
        height: 78px !important;
    }
    
    .yoyaku-player-ultra-fin .vinyl-wrapper,
    .yoyaku-player-ultra-fin .vinyl-image {
        width: 32px !important;
        height: 32px !important;
    }
    
    .yoyaku-player-ultra-fin .waveform-container {
        height: 35px !important;
    }
    
    body {
        padding-bottom: 80px !important;
    }
}

/* ==============================================
   DEBUGGING HELPERS
   ============================================== */

.debug-iphone-player {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(255, 0, 0, 0.9);
    color: white;
    padding: 5px;
    font-size: 10px;
    z-index: 999999;
    border-radius: 3px;
}